<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="'–ü–µ—Ä—Å–æ–Ω–∞–∂ ' + ${character.name}">–ü–µ—Ä—Å–æ–Ω–∞–∂</title>
  <link rel="stylesheet" th:href="@{/css/character.css}">
  <style>
    .inline-edit-form {
      display: none;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }
    .btn-symbol {
      background: transparent;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      padding: 0 0.3rem;
      line-height: 1;
    }
    .btn-symbol:hover {
      color: #2e86de;
    }
    .item-actions,
    .inventory-actions,
    .subitem-actions {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', e => {
          e.preventDefault();
          const form = btn.closest('.item-card').querySelector('.inline-edit-form');
          form.style.display = form.style.display === 'flex' ? 'none' : 'flex';
        });
      });
    });
  </script>
</head>
<body>
<div class="page-wrapper">
  <div class="container">
    <header class="character-header">
      <h1 th:text="${character.name}">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h1>
    </header>
    <main class="character-content">
      <div class="left-column">
        <!-- –†–ê–ù–´ -->
        <section class="section">
          <h2 class="section-title">–†–∞–Ω—ã</h2>
          <form th:action="@{'/character/' + ${character.id} + '/wounds'}" method="post" class="add-form">
            <div class="form-group">
              <input type="text" name="name" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required autocomplete="off">
              <input type="number" name="severity" placeholder="–¢—è–∂–µ—Å—Ç—å" min="1" step="1">
            </div>
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
          <div class="items-list">
            <div th:each="wound : ${character.wounds}" class="item-card">
              <div class="item-info">
                <span class="item-name" th:text="${wound.name}">–ù–∞–∑–≤–∞–Ω–∏–µ</span>
                <span th:if="${wound.severity != null}" class="item-detail">
                    (—Ç—è–∂–µ—Å—Ç—å: <span th:text="${wound.severity}">1</span>)
                  </span>
              </div>
              <div class="item-actions">
                <button class="btn-symbol btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
                <form th:action="@{'/character/' + ${character.id} + '/wounds/' + ${wound.id} + '/delete'}"
                      method="post" class="inline-form" style="margin:0;">
                  <button type="submit" class="btn-symbol" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                </form>
              </div>
              <form th:action="@{'/character/' + ${character.id} + '/wounds/' + ${wound.id} + '/edit'}"
                    method="post" class="inline-edit-form" style="display:none;flex-wrap:wrap;">
                <input type="text" name="name" th:value="${wound.name}" required placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                <input type="number" name="severity" th:value="${wound.severity}" min="1" placeholder="–¢—è–∂–µ—Å—Ç—å">
                <button type="submit" class="btn btn-small btn-secondary">OK</button>
              </form>
            </div>
            <div th:if="${#lists.isEmpty(character.wounds)}" class="empty-state">
              <span>–ù–µ—Ç —Ä–∞–Ω</span>
            </div>
          </div>
        </section>

        <!-- –ò–ù–í–ï–ù–¢–ê–†–ò -->
        <section class="section">
          <h2 class="section-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏</h2>
          <form th:action="@{'/character/' + ${character.id} + '/inventories'}" method="post" class="add-form">
            <div class="form-group">
              <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required autocomplete="off">
            </div>
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
          <div class="items-list">
            <div th:each="inv : ${character.inventories}" class="item-card inventory-card">
              <div class="inventory-header">
                <span class="item-name" th:text="${inv.name}">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                <div class="inventory-actions">
                  <button class="btn-symbol btn-edit" title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å">‚úé</button>
                  <form th:action="@{'/character/' + ${character.id} + '/inventories/' + ${inv.id} + '/delete'}"
                        method="post" class="inline-form" style="margin:0;">
                    <button type="submit" class="btn-symbol" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                  </form>
                </div>
              </div>
              <form th:action="@{'/character/' + ${character.id} + '/inventories/' + ${inv.id} + '/edit'}"
                    method="post" class="inline-edit-form" style="display:none;flex-wrap:wrap;">
                <input type="text" name="name" th:value="${inv.name}" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <button type="submit" class="btn btn-small btn-secondary">OK</button>
              </form>
              <div class="inventory-content">
                <form th:action="@{'/character/' + ${character.id} + '/inventories/' + ${inv.id} + '/items'}"
                      method="post" class="add-subitem-form">
                  <div class="form-group">
                    <input type="text" name="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required autocomplete="off">
                    <input type="number" name="quantity" placeholder="–ö–æ–ª-–≤–æ" required min="1">
                    <input type="number" name="cost" placeholder="–¶–µ–Ω–∞" required min="0">
                    <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                  </div>
                </form>
                <div class="items-sublist">
                  <div th:each="item : ${inv.content}" class="subitem-card">
                    <div class="item-info">
                      <span class="item-name" th:text="${item.name}">–ü—Ä–µ–¥–º–µ—Ç</span>
                      <span class="item-quantity">√ó<span th:text="${item.quantity}">1</span></span>
                      <span class="item-cost">‚ÇΩ<span th:text="${item.cost}">0</span></span>
                    </div>
                    <div class="subitem-actions">
                      <button class="btn-symbol btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
                      <form th:action="@{'/character/' + ${character.id} + '/inventories/' + ${inv.id} + '/items/' + ${item.id} + '/delete'}"
                            method="post" class="inline-form" style="margin:0;">
                        <button type="submit" class="btn-symbol" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                      </form>
                    </div>
                    <form th:action="@{'/character/' + ${character.id} + '/inventories/' + ${inv.id} + '/items/' + ${item.id} + '/edit'}"
                          method="post" class="inline-edit-form" style="display:none;flex-wrap:wrap;">
                      <input type="text" name="itemName" th:value="${item.name}" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                      <input type="number" name="quantity" th:value="${item.quantity}" min="1" placeholder="–ö–æ–ª-–≤–æ">
                      <input type="number" name="cost" th:value="${item.cost}" min="0" placeholder="–¶–µ–Ω–∞">
                      <input type="text" name="description" th:value="${item.description}" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                      <button type="submit" class="btn btn-small btn-secondary">OK</button>
                    </form>
                  </div>
                  <div th:if="${#lists.isEmpty(inv.content)}" class="empty-state">
                    <span>–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤</span>
                  </div>
                </div>
              </div>
            </div>
            <div th:if="${#lists.isEmpty(character.inventories)}" class="empty-state">
              <span>–ù–µ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–π</span>
            </div>
          </div>
        </section>
      </div>

      <div class="right-column">
        <section class="section">
          <h2 class="section-title">–î–µ–Ω—å–≥–∏</h2>
          <div class="money-summary">
            <span class="money-total">–°—É–º–º–∞: <strong th:text="${moneySum}">0</strong></span>
          </div>
          <form th:action="@{'/character/' + ${character.id} + '/money'}" method="post" class="add-form">
            <div class="form-group">
              <input type="text" name="name" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required autocomplete="off">
              <input type="number" name="amount" placeholder="–°—É–º–º–∞" required autocomplete="off">
            </div>
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
          <div class="items-list">
            <div th:each="money : ${moneyList}" class="item-card money-item">
              <div class="item-info">
                <span class="item-name" th:text="${money.name}">–û–ø–µ—Ä–∞—Ü–∏—è</span>
                <span class="money-amount" th:text="${money.amount}">0</span>
                <span class="item-date" th:text="${money.operationDate}">–î–∞—Ç–∞</span>
              </div>
              <div class="item-actions">
                <button class="btn-symbol btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
                <form th:action="@{'/character/' + ${character.id} + '/money/' + ${money.id} + '/delete'}"
                      method="post" class="inline-form" style="margin:0;">
                  <button type="submit" class="btn-symbol" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                </form>
              </div>
              <form th:action="@{'/character/' + ${character.id} + '/money/' + ${money.id} + '/edit'}"
                    method="post" class="inline-edit-form" style="display:none;flex-wrap:wrap;">
                <input type="text" name="name" th:value="${money.name}" required placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                <input type="number" name="amount" th:value="${money.amount}" placeholder="–°—É–º–º–∞">
                <button type="submit" class="btn btn-small btn-secondary">OK</button>
              </form>
            </div>
            <div th:if="${#lists.isEmpty(moneyList)}" class="empty-state">
              <span>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</span>
            </div>
          </div>
        </section>
      </div>
    </main>
    <footer class="character-footer">
      <a href="/" class="btn btn-back">‚Üê</a>
    </footer>
  </div>
</div>
</body>
</html>
